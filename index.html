<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ÙØ§Ø­Øµ Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± â€” Ù…Ø¹ ØªØ¹Ø²ÙŠØ²</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: "Tahoma", Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #0073b1;
      color: #000;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background: #fff;
      text-align: center;
      padding: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.18);
    }
    header h1 {
      margin: 0;
      font-size: 22px;
      color: #000;
      border: 2px solid #000;
      display: inline-block;
      padding: 6px 12px;
      border-radius: 8px;
    }

    .container {
      background: #fff;
      padding: 18px 22px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.18);
      width: 380px;
      margin: 24px auto;
      text-align: center;
    }

    .password-wrapper {
      position: relative;
      width: 100%;
      margin: 12px 0;
    }
    .password-wrapper input {
      width: 100%;
      padding: 10px 40px 10px 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
      box-sizing: border-box;
      direction: rtl;
      text-align: right;
    }
    .toggle-btn {
      position: absolute;
      top: 50%;
      left: 12px;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 16px;
      color: #555;
    }

    .progress-container {
      width: 100%;
      background: #eee;
      border-radius: 8px;
      margin-top: 8px;
      height: 12px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: red;
      transition: width 0.35s ease;
    }

    .strength {
      font-weight: bold;
      margin-top: 10px;
      padding: 6px;
      border-radius: 8px;
      font-size: 14px;
    }

    .tips { margin-top: 8px; font-size: 13px; color:#333; text-align:right; }

    .info { margin-top: 12px; text-align:right; font-size:14px; }
    .info strong{ display:block; color:#004080; margin-top:8px; }
    .result-text{ font-weight:700; color:#000; margin-right:10px; }

    .actions { margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center; }
    button {
      padding:10px 14px;
      border-radius:8px;
      border:none;
      background:linear-gradient(90deg,#0073b1,#00a8e8);
      color:#fff;
      cursor:pointer;
      font-size:14px;
    }
    button.secondary { background:#555; }

    footer {
      margin-top:auto;
      background:#fff;
      padding:12px;
      border-top:2px solid #0073b1;
      text-align:center;
    }
    footer div { display:inline-block; border:2px solid #0073b1; padding:8px 14px; border-radius:8px; color:#004080; font-weight:700; margin:4px; }
  </style>
</head>
<body>
  <header>
    <h1>ÙØ§Ø­Øµ Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h1>
  </header>

  <div class="container">
    <div class="password-wrapper">
      <input id="password" type="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <i id="toggleIcon" class="fa-solid fa-eye toggle-btn" onclick="togglePassword()"></i>
    </div>

    <div class="progress-container"><div id="progressBar" class="progress-bar"></div></div>
    <div id="result" class="strength">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
    <div id="tips" class="tips"></div>

    <div class="info">
      <strong>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚:</strong>
      <div class="result-text" id="pwned">-</div>

      <strong>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (Ù…Ø­Ù„ÙŠØ§Ù‹):</strong>
      <div class="result-text" id="reuse">-</div>

      <strong>ØªØ­Ø°ÙŠØ±:</strong>
      <div class="result-text" id="warning">-</div>
    </div>

    <div class="actions">
      <button id="checkBtn">ğŸ” ÙØ­Øµ Ø§Ù„ÙƒÙ„Ù…Ø©</button>
      <button id="generateBtn">âš¡ ØªÙˆÙ„ÙŠØ¯ / ØªØ¹Ø²ÙŠØ²</button>
      <button id="saveBtn" class="secondary">ğŸ’¾ Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹</button>
      <button id="clearBtn" class="secondary">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ÙÙˆØ¸</button>
    </div>
  </div>

  <footer>
    <div>Ø§Ù„Ø·Ø§Ù„Ø¨ Ù†Ø§ÙŠÙ Ø§Ù„Ø¹Ù†Ø²ÙŠ</div>
    <div>Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ù„Ø¹Ù‚ÙŠÙ„</div>
  </footer>

  <script>
    // ---------- Ù…Ø³Ø§Ø¹Ø¯Ø©: ØªÙˆÙ„ÙŠØ¯ Ø­Ø±Ù/Ø±Ù…Ø² Ø¹Ø´ÙˆØ§Ø¦ÙŠ ----------
    function randomChar() {
      const pool = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{};:,.<>?";
      return pool.charAt(Math.floor(Math.random() * pool.length));
    }

    // ---------- ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ÙƒØ§Ù…Ù„Ø© ----------
    function generateRandomPassword(length = 14) {
      const pool = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}<>?";
      let p = "";
      const cryptoArr = new Uint32Array(length);
      window.crypto.getRandomValues(cryptoArr);
      for (let i=0;i<length;i++){
        p += pool[cryptoArr[i] % pool.length];
      }
      return p;
    }

    // ---------- ØªØ¹Ø²ÙŠØ² ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ----------
    // Ø³Ù„ÙˆÙƒ: Ø¥Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ ÙÙŠÙ‡ Ù†Øµ -> 50% ÙŠØ¶ÙŠÙ '@' ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŒ 50% ÙŠØ¶ÙŠÙ Ø­Ø±Ù/Ø±Ù‚Ù…/Ø±Ù…Ø² Ø¹Ø´ÙˆØ§Ø¦ÙŠ
    function enhanceUserPassword(pw) {
      if (!pw) return generateRandomPassword(14);
      if (Math.random() < 0.5) {
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ '@' Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ù†Ø¶ÙŠÙÙ‡ØŒ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¶ÙŠÙ Ø±Ù…Ø² Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        return pw.includes('@') ? pw + randomChar() : pw + '@';
      } else {
        return pw + randomChar();
      }
    }

    // ---------- Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ----------
    function togglePassword() {
      const pw = document.getElementById('password');
      const icon = document.getElementById('toggleIcon');
      if (pw.type === 'password') {
        pw.type = 'text'; icon.classList.remove('fa-eye'); icon.classList.add('fa-eye-slash');
      } else {
        pw.type = 'password'; icon.classList.remove('fa-eye-slash'); icon.classList.add('fa-eye');
      }
    }

    // ---------- ÙØ­Øµ Ø§Ù„Ù‚ÙˆØ© + ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ----------
    function updateStrengthUI(password) {
      const result = document.getElementById('result');
      const tips = document.getElementById('tips');
      const progress = document.getElementById('progressBar');
      const warning = document.getElementById('warning');

      let score = 0;
      let suggestions = [];

      if (password.length >= 8) score++; else suggestions.push("ğŸ”¹ Ø§Ø³ØªØ®Ø¯Ù… 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
      if (/[A-Z]/.test(password)) score++; else suggestions.push("ğŸ”¹ Ø£Ø¶Ù Ø­Ø±Ù ÙƒØ¨ÙŠØ± (A-Z)");
      if (/[0-9]/.test(password)) score++; else suggestions.push("ğŸ”¹ Ø£Ø¶Ù Ø£Ø±Ù‚Ø§Ù…");
      if (/[^A-Za-z0-9]/.test(password)) score++; else suggestions.push("ğŸ”¹ Ø£Ø¶Ù Ø±Ù…ÙˆØ² Ø®Ø§ØµØ© Ù…Ø«Ù„ !@#$");

      const percent = (score / 4) * 100;
      progress.style.width = percent + "%";
      progress.style.background = score <= 1 ? "red" : score === 2 ? "orange" : "green";

      if (!password) {
        result.textContent = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±";
        result.className = "strength";
        tips.innerHTML = "";
        warning.textContent = "-";
      } else if (score <= 1) {
        result.textContent = "Ø¶Ø¹ÙŠÙØ©";
        result.className = "strength weak";
        tips.innerHTML = suggestions.join("<br>");
        warning.textContent = "âš ï¸ Ø¶Ø¹ÙŠÙØ© â€” Ø­Ø³Ù‘Ù†Ù‡Ø§ Ø¨Ø¥Ø¶Ø§ÙØ© Ø·ÙˆÙ„/Ø­Ø±ÙˆÙ/Ø±Ù…ÙˆØ²";
      } else if (score === 2) {
        result.textContent = "Ù…ØªÙˆØ³Ø·Ø©";
        result.className = "strength";
        tips.innerHTML = suggestions.join("<br>");
        warning.textContent = "âš ï¸ Ù…ØªÙˆØ³Ø·Ø© â€” ÙŠÙ…ÙƒÙ†Ùƒ Ø¬Ø¹Ù„Ù‡Ø§ Ø£Ù‚ÙˆÙ‰";
      } else {
        result.textContent = "Ù‚ÙˆÙŠØ©";
        result.className = "strength";
        tips.innerHTML = "âœ… ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¬ÙŠØ¯Ø©. Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ø¬Ø¹Ù„Ù‡Ø§ Ø£Ø·ÙˆÙ„.";
        warning.textContent = "âœ… Ù‚ÙˆÙŠØ©";
      }
    }

    // ---------- ØªØ¬Ø²Ø¦Ø© SHA-1 Ùˆ SHA-256 ----------
    async function sha1Hex(str) {
      const buf = await crypto.subtle.digest("SHA-1", new TextEncoder().encode(str));
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('').toUpperCase();
    }
    async function sha256Hex(str) {
      const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    // ---------- ÙØ­Øµ ØªØ³Ø±ÙŠØ¨Ø§Øª Ø¹Ø¨Ø± HIBP (k-anonymity) ----------
    async function checkPwned(password) {
      if (!password) return "-";
      try {
        const sha1 = await sha1Hex(password);
        const prefix = sha1.slice(0,5);
        const suffix = sha1.slice(5);
        const resp = await fetch(`https://api.pwnedpasswords.com/range/${prefix}`);
        if (!resp.ok) throw new Error('network');
        const text = await resp.text();
        const lines = text.split('\n');
        for (const line of lines) {
          const [hash,count] = line.trim().split(':');
          if (hash === suffix) return `âš ï¸ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§ ${count} Ù…Ø±Ø© ÙÙŠ Ø§Ù„ØªØ³Ø±ÙŠØ¨Ø§Øª!`;
        }
        return 'âœ… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„ØªØ³Ø±ÙŠØ¨Ø§Øª';
      } catch (e) {
        return 'âš ï¸ Ø®Ø·Ø£ Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ (Ù„Ø§ Ø§ØªØµØ§Ù„)';
      }
    }

    // ---------- Ø³Ø¬Ù„ Ù…Ø­Ù„ÙŠ (Ø¨ØµÙ…Ø§Øª SHA-256) ----------
    const KEY = 'pw_checker_history';
    function loadHistory(){ try{ return JSON.parse(localStorage.getItem(KEY))||[] }catch{ return [] } }
    function saveHistory(arr){ localStorage.setItem(KEY, JSON.stringify(arr)) }
    async function checkReuse(password){ if(!password) return false; const h = await sha256Hex(password); return loadHistory().includes(h); }

    // ---------- Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± ----------
    document.getElementById('checkBtn').addEventListener('click', async ()=>{
      const pw = document.getElementById('password').value;
      updateStrengthUI(pw);
      document.getElementById('pwned').textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
      document.getElementById('reuse').textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';

      const pwned = await checkPwned(pw);
      document.getElementById('pwned').textContent = pwned;

      const reused = await checkReuse(pw);
      document.getElementById('reuse').textContent = reused ? 'âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‡Ø°Ù‡ Ø§Ø³ØªÙØ®Ø¯Ù…Øª Ø³Ø§Ø¨Ù‚Ø§Ù‹ (Ù…Ø­Ù„ÙŠØ§Ù‹)' : 'âœ… Ù„Ù… ØªÙØ³ØªØ®Ø¯Ù… Ù…Ø­Ù„ÙŠØ§Ù‹';
    });

    // Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø¹Ø¯Ù„: ÙŠÙˆÙ„Ø¯ Ø¥Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ ÙØ§Ø¶ÙŠØŒ ÙˆØ¥Ù„Ø§ ÙŠØ¹Ø²Ø² Ù†ÙØ³ Ø§Ù„ÙƒÙ„Ù…Ø© (ÙŠØ¶ÙŠÙ @ Ø£Ùˆ Ø­Ø±Ù Ø¹Ø´ÙˆØ§Ø¦ÙŠ)
    document.getElementById('generateBtn').addEventListener('click', ()=>{
      const input = document.getElementById('password');
      const current = input.value.trim();
      let newPass;
      if (!current) {
        newPass = generateRandomPassword(14);
      } else {
        newPass = enhanceUserPassword(current);
      }
      input.value = newPass;
      updateStrengthUI(newPass);
      // Ù†ØªØ±Ùƒ ÙØ­Øµ Ø§Ù„ØªØ³Ø±ÙŠØ¨Ø§Øª ÙˆØ§Ù„Ø­ÙØ¸ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø²Ø± Ø§Ù„ÙØ­Øµ/Ø­ÙØ¸) Ù„Ø®ØµÙˆØµÙŠØ© Ø£ÙØ¶Ù„
    });

    document.getElementById('saveBtn').addEventListener('click', async ()=>{
      const pw = document.getElementById('password').value;
      if (!pw) { alert('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø£ÙˆÙ„Ø§Ù‹'); return; }
      const h = await sha256Hex(pw);
      const arr = loadHistory();
      if (!arr.includes(h)) arr.push(h);
      saveHistory(arr);
      alert('ØªÙ… Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ø¨ØµÙ…Ø© Ù…Ø´ÙØ±Ø©) Ù…Ø­Ù„ÙŠØ§Ù‹.');
    });

    document.getElementById('clearBtn').addEventListener('click', ()=>{
      localStorage.removeItem(KEY);
      alert('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ.');
    });

    // ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© (Ø®ÙØ© ÙˆØ§Ø¬Ù‡Ø©)
    let debounce;
    document.getElementById('password').addEventListener('input', e=>{
      clearTimeout(debounce);
      debounce = setTimeout(()=> updateStrengthUI(e.target.value), 220);
    });
  </script>
</body>
</html>
